---
title: "rapport"
author: "Thierry"
date: "4/19/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(lubridate)
library(readxl)

```


## Lecture des données

```{r}

data <- read.csv("../data/Ambatomainty/Exported_Baseline_Ambatomainty.txt", sep = ";") %>% 
  mutate(DATE = dmy(DATE))

valueset <- read_excel("../data/disctionary_suivi.xlsx", 4)

# remplacer les valeurs de la colonne choix par celles de correspondance dans data
valueset_list <- valueset %>% select(choix, correpondance) %>% 
  split(valueset$variable)

field_partners <- valueset_list[[1]][,c(3,4)] 
names(field_partners) <- c("values", unique(valueset_list[[1]][1]))

data_1 <- field_partners %>% 
  right_join(data)
  

data_2 <- data_1 %>% 
  mutate(FIELD_PARTNER_SINGLE_FCT = values) %>% 
  select(-values)


# Changer le nom de toutes les colonnes
data_tidy_1 <- valueset_list %>% 
  imap(function(x,y) x %>% rename_with(~paste(y), 1))

data_tidy_2 <- valueset_list %>% 
  imap(function(x,y) x %>% rename_with(~paste(y), 2))


# Début de réponse
data_merged <- data_tidy_1 %>% 
  map(left_join, data, by = character())

data_merged2 <- data_tidy_1 %>% 
  lapply(merge, data)

data_merged3 <-  data %>% 
  reduce(data_tidy_1, left_join)


```


